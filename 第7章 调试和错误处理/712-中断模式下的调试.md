##中断模式下的调试

&emsp;&emsp;调试技术的剩余内容在中断模式下工作。可以通过几种方式进入这种模式，这些方式都会以某种方式暂停程序的执行。

### &emsp;&emsp;1. 进入中断模式

&emsp;&emsp;进入中断模式的最简单方式是在运行应用程序时，单击IDE中的 `全部中断` 按钮。这个 `全部中断` 按钮在 `调试` 工具栏上，应把该工具栏添加到VS默认显示的工具栏中。为此，右击工具栏区域，然后选择 `调试`，这个工具栏 **`如图 7-6 所示`**。

![图7-6](/assets/7-6.png)
**`图 7-6`**

&emsp;&emsp;在这个工具栏上，前 3 个按钮可以手工控制中断。在 **`图 7-6`** 上，它们显示为灰色，因为在程序没有运行时，它们是不能工作的。在后面的章节需要其他按钮时，再介绍它们。

&emsp;&emsp;运行一个应用程序时，工具栏就 **`如图 7-7 所示`**。

![图7-7](/assets/7-7.png)
**`图 7-7`**

&emsp;&emsp;现在，就可以使用之前显示为灰色的 3 个按钮了。它们可以：

&emsp;&emsp; ● 暂停应用程序的执行，进入中断模式

&emsp;&emsp; ● 完全停止应用程序的执行（不进入中断模式，而是退出应用程序）

&emsp;&emsp; ● 重新启动应用程序

&emsp;&emsp;暂停应用程序是进入中断模式的最简单方式，但这并不能更好地控制停止程序运行的位置。我们可能会停止在应用程序正常暂停的地方，例如，要求用户输入信息。还可以在长时间的操作或循环过程中进入中断模式，但停止的位置可能相当随机。一般情况下，最好使用断点。


####&emsp;&emsp; 断点

&emsp;&emsp;断点是源代码中自动进入中断模式的一个标记。它们可以配置为：

&emsp;&emsp; ● 在遇到断点时，立即进入中断模式

&emsp;&emsp; ● 在遇到断点时，如果布尔表达式的值为 `true`，就进入中断模式

&emsp;&emsp; ● 遇到某断点一定的次数后，进入中断模式

&emsp;&emsp; ● 在遇到断点时，如果自从上次遇到断点以来变量的值发生了变化，就进入中断模式

&emsp;&emsp; ● 把文本输出到 `输出` 窗口中，或者执行一个宏（参见 “跟踪点”小节）

&emsp;&emsp;注意 ⚠️，上述功能仅能用于调试程序。如果编译发布程序，将忽略所有断点。

&emsp;&emsp;添加断点有几种方法。要添加简单断点，当遇到该断点所在的代码行时，就中断执行，可以单击该代码行左边的灰色区域。其他方法包括：右击该行代码行，选择 ` 断点 | 插入断点 ` 菜单项；或者按下 `F9` 键。

&emsp;&emsp;断点在代码行的旁边显示为一个红色圆圈，而该行代码也突出显示，**`如图 7-8 所示`**。

![图7-8](/assets/7-8.png)
**`图 7-8`**

&emsp;&emsp;使用 `Breakpoints` 窗口还可以查看文件中的断点信息（前面介绍过启用该窗口的方法）。在 `Breakpoints` 窗口中，可以禁用断点（删除描述信息左边的记号；禁用的断点用未填充的红色圆圈来表示），删除断点，编辑断点的属性。还可以为断点添加标签，这是分组选定断点的一种便捷方式。可以在 `Labels` 列中查看标签，以及按标签筛选 `Breakpoints` 窗口中的项。

&emsp;&emsp;这个窗口中显示的 `条件` 和 `命中次数` 菜单项，就可以编辑它们。

&emsp;&emsp;选择 `条件` 将弹出一个对话框。在该对话框中可以键入任意布尔表达式，该表达式可以包含在断点位置仍在作用域内的任何变量。例如，可以配置一个断点，输入表达式 `maxVal > 4`，选择 `Is true` 选项，则在遇到这个断点，且 `maxVal` 的值大于 4 时，就会触发该断点。还可以检查这个表达式时否有变化，仅当发生变化时，才会出发断点（例如，如果在遇到断点时，`maxVal` 的值从 2 改为 6，就会触发该断点）。

&emsp;&emsp;选择 `命中次数` 将弹出另一个对话框。在这个对话框中可以指定在遇到断点多少次后才触发该断点。该对话框中的下拉列表提供了如下选项：

&emsp;&emsp; ● 总是中断

&emsp;&emsp; ● 中断，条件是命中次数等于

&emsp;&emsp; ● 中断，条件时命中次数几倍于

&emsp;&emsp; ● 中断，条件是命中次数大于或等于

&emsp;&emsp;所选的选项与选项旁边的文本框中输入的值共同确定断点的行为。这个计数在比较长的循环中很有用，例如，在执行了前 5000 次循环后需要中断。如果不这么做，中断并再启动 5000 次是很痛苦的。

>&emsp;&emsp;**带有附加属性集（例如，条件或遇到断点的次数）的断点在显示时与普通断点略有区别。已配置的断点不是显示一个简单的红色圆圈，而在红色的圆圈中有一个白色加好。这是很有用的，因为它允许很快辨认出哪个断点总是进入中断模式，哪个断点仅在某种情况下才进入中断模式。**

####&emsp;&emsp;进入中断模式的其他方式

&emsp;&emsp;进入中断模式还有两种方式。一种是在抛出一个未处理的异常时选择进入该模式。这种方式在本章后面讨论到错误处理时论述。另一种方式是在生成一个判定语句时中断。

&emsp;&emsp;**判定语句**是可以用用户定义的消息中断应用程序的指令。它们常常用于应用程序的开发过程，作为测试程序时否能平滑运行的一种方式。例如，在应用程序的某一处要求给定的变量值小于 10，此时就可以使用一个判定语句，确定它是否为 `true`，如果不是，就中断程序的执行。当遇到判定语句时，可以选择 `Abort`，中断应用程序的执行，也可以选择 `Retry`，进入中断模式，还可以选择 `Ignore`，让应用程序像往常一样继续执行。

&emsp;&emsp;与前面的调试输出函数一样，判定函数也有两个版本：

&emsp;&emsp; ● Debug.Assert()

&emsp;&emsp; ● Trace.Assert()

&emsp;&emsp;其调试版本也是仅用于编译调试程序。

&emsp;&emsp;这两个函数带 3 个参数。第一个参数是一个布尔值，其值为 `false` 会触发判定语句。第二、三个参数是两个字符串，分别把信息写到弹出的对话框和 `输出` 窗口中。上面的示例需要一个函数调用，如下所示：

```javascript
        Debug.Assert(myVar < 10, "myVar is 10 or greater.", "Assertion occurred in Main().");
```















🔚